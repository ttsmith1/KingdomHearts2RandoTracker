{"version":3,"sources":["../../js/co_op.js"],"names":[],"mappings":";;AAAA,IAAI,MAAJ;;AAEA,SAAS,aAAT,CAAuB,IAAvB,EAA6B;AAAA;;AAC3B,MAAI,MAAJ,EAAY;AACV,IAAA,MAAM,CAAC,KAAP,CAAa,IAAb;AAEF,QAAA,CAAC,CAAC,cAAD,CAAD,0CAAmB,MAAnB;AAEA,EAAA,MAAM,GAAG,IAAI,SAAJ,WAAT;AACA,EAAA,MAAM,CAAC,gBAAP,CAAwB,OAAxB,EAAiC,UAAA,CAAC,EAAI;AACpC,QAAM,MAAM,GAAG,CAAC,CAAC,UAAD,CAAhB;AACA,IAAA,MAAM,CAAC,SAAP,CAAiB,GAAjB,CAAqB,QAArB;AACA,IAAA,MAAM,CAAC,WAAP,GAAqB,mDAArB;AACD,GAJD;AAKD;;AAED,SAAS,UAAT,CAAoB,IAApB,EAA0B,IAA1B,EAAgC;AAC9B,MAAM,GAAG,GAAG,QAAQ,CAAC,aAAT,CAAuB,KAAvB,CAAZ;AACA,EAAA,GAAG,CAAC,SAAJ,CAAc,GAAd,CAAkB,KAAlB,EAAyB,SAAzB;AAEA,MAAM,CAAC,GAAG,QAAQ,CAAC,aAAT,CAAuB,GAAvB,CAAV;AACA,EAAA,CAAC,CAAC,WAAF,GAAgB,IAAhB;AACA,EAAA,GAAG,CAAC,WAAJ,CAAgB,CAAhB;AAEA,EAAA,IAAI,CAAC,qBAAL,CAA2B,UAA3B,EAAuC,GAAvC;AACD;;AAED,SAAS,QAAT,CAAkB,GAAlB,EAAuB;AACrB,SAAO,CAAC,kBAAU,GAAG,CAAC,IAAd,UAAwB,CAAC,gCAAwB,GAAG,CAAC,EAA5B,SAAzB,CAAD,CAA+D,aAAtE;AACD;;AAED,SAAS,cAAT,CAAwB,KAAxB,EAA+B,IAA/B,EAAqC;AACnC,MAAM,GAAG,GAAG,IAAI,CAAC,KAAL,CAAW,KAAK,CAAC,IAAjB,CAAZ;;AAEA,UAAQ,GAAG,CAAC,IAAZ;AACE,SAAK,cAAL;AAAqB;AACnB,QAAA,CAAC,CAAC,UAAD,CAAD,CAAc,SAAd,yCAAyD,GAAG,CAAC,EAA7D;AACA;AACD;;AAED,SAAK,aAAL;AAAoB;AAClB,YAAM,OAAO,GAAG,GAAG,CAAC,EAApB;AACA;AACD;;AAED,SAAK,aAAL;AAAoB;AAClB,YAAM,OAAO,GAAG,CAAC,CAAC,OAAD,CAAD,CAAW,SAAX,CAAqB,IAArB,CAAhB;AACA,QAAA,OAAO,CAAC,OAAR,CAAgB,MAAhB,GAAyB,GAAG,CAAC,EAA7B;AACA,QAAA,CAAC,CAAC,MAAD,CAAD,CAAU,WAAV,CAAsB,OAAtB;AACA;AACD;;AAED,SAAK,WAAL;AAAkB;AAChB,QAAA,CAAC,gCAAwB,GAAG,CAAC,EAA5B,SAAD,CAAqC,MAArC;AACA;AACD;;AAED,SAAK,OAAL;AAAc;AACZ,QAAA,UAAU,CAAC,IAAD,mBAAiB,GAAG,CAAC,OAArB,EAAV;AACA;AACD;;AAED,SAAK,cAAL;AAAqB;AACnB,QAAA,aAAa,CAAC;AAAE,UAAA,aAAa,EAAE,QAAQ,CAAC,GAAD;AAAzB,SAAD,EAAmC,GAAG,CAAC,MAAvC,CAAb;AACA;AACD;;AAED,SAAK,gBAAL;AAAuB;AACrB,QAAA,eAAe,CAAC;AAAE,UAAA,aAAa,EAAE,QAAQ,CAAC,GAAD;AAAzB,SAAD,CAAf;AACA;AACD;;AAED,SAAK,cAAL;AAAqB;AACnB,QAAA,aAAa,CAAC;AAAE,UAAA,aAAa,EAAE,QAAQ,CAAC,GAAD;AAAzB,SAAD,CAAb;AACA;AACD;AAzCH;AA2CD;;AAED,CAAC,CAAC,aAAD,CAAD,CAAiB,QAAjB,GAA4B,UAAC,KAAD,EAAW;AACrC,EAAA,aAAa,CAAC,KAAK,CAAC,MAAP,CAAb;AAEA,EAAA,MAAM,CAAC,gBAAP,CAAwB,MAAxB,EAAgC,YAAM;AACpC,IAAA,MAAM,CAAC,IAAP,CAAY,IAAI,CAAC,SAAL,CAAe;AACzB,MAAA,IAAI,EAAE,WADmB;AAEzB,MAAA,IAAI,EAAE,CAAC,CAAC,mBAAD,CAAD,CAAuB;AAFJ,KAAf,CAAZ;AAID,GALD;AAMA,EAAA,MAAM,CAAC,gBAAP,CAAwB,SAAxB,EAAmC,UAAA,CAAC;AAAA,WAAI,cAAc,CAAC,CAAD,EAAI,KAAK,CAAC,MAAV,CAAlB;AAAA,GAApC;AAEA,SAAO,KAAP;AACD,CAZD;;AAcA,CAAC,CAAC,eAAD,CAAD,CAAmB,QAAnB,GAA8B,UAAC,KAAD,EAAW;AACvC,EAAA,aAAa,CAAC,KAAK,CAAC,MAAP,CAAb;AAEA,MAAI,IAAI,GAAG,QAAQ,CAAC,CAAC,CAAC,qBAAD,CAAD,CAAyB,KAA1B,CAAnB;;AACA,MAAI,CAAC,IAAL,EAAW;AACT,IAAA,UAAU,CAAC,KAAK,CAAC,MAAP,EAAe,+CAAf,CAAV;AACA,IAAA,IAAI,GAAG,CAAP;AACD;;AAED,MAAM,MAAM,GAAG,CAAC,CAAC,UAAD,CAAhB;AACA,EAAA,MAAM,CAAC,SAAP,CAAiB,GAAjB,CAAqB,QAArB;AACA,EAAA,MAAM,CAAC,WAAP;AAEA,EAAA,MAAM,CAAC,gBAAP,CAAwB,MAAxB,EAAgC,YAAM;AACpC,IAAA,MAAM,CAAC,IAAP,CAAY,IAAI,CAAC,SAAL,CAAe;AACzB,MAAA,IAAI,EAAE,aADmB;AAEzB,MAAA,IAAI,EAAE;AAFmB,KAAf,CAAZ;AAID,GALD;AAMA,EAAA,MAAM,CAAC,gBAAP,CAAwB,SAAxB,EAAmC,UAAA,CAAC;AAAA,WAAI,cAAc,CAAC,CAAD,EAAI,KAAK,CAAC,MAAV,CAAlB;AAAA,GAApC;AAEA,SAAO,KAAP;AACD,CAtBD;;AAwBA,IAAM,eAAe,GAAG,CAAC,CAAC,gBAAD,CAAzB;;AACA,IAAI;AAAA;;AAAE,EAAA,eAAe,CAAC,KAAhB,4BAAwB,YAAY,CAAC,WAArC,yEAAoD,IAApD;AAA0D,CAAhE,CACA,gBAAM,CAAE;;AACR,eAAe,CAAC,OAAhB,GAA0B,UAAA,KAAK,EAAI;AACjC,MAAM,OAAO,GAAG,KAAK,CAAC,MAAN,CAAa,KAA7B;AACA,MAAM,IAAI,GAAG,CAAC,CAAC,MAAD,CAAd;AAEA,EAAA,IAAI,CAAC,KAAL,CAAW,mBAAX,GAAiC,OAAO,oBAAa,OAAb,eAA+B,IAAvE;;AAEA,MAAI;AAAE,IAAA,YAAY,CAAC,WAAb,GAA2B,OAA3B;AAAoC,GAA1C,CACA,iBAAM,CAAE;AACT,CARD;;AASA,eAAe,CAAC,OAAhB,CAAwB;AAAE,EAAA,MAAM,EAAE;AAAV,CAAxB","file":"co_op.js","sourcesContent":["var socket;\n\nfunction connectSocket(elem) {\n  if (socket) // Ensure old connections are closed\n    socket.close(1000)\n\n  $(\".row.message\")?.remove();\n\n  socket = new WebSocket(process.env.WS_URL);\n  socket.addEventListener(\"error\", e => {\n    const roomId = $(\"#room_id\");\n    roomId.classList.add(\"active\");\n    roomId.textContent = \"Could not connect to server. (Server may be down)\";\n  });\n}\n\nfunction createPRow(elem, text) {\n  const row = document.createElement(\"div\");\n  row.classList.add(\"row\", \"message\");\n\n  const p = document.createElement(\"p\");\n  p.textContent = text;\n  row.appendChild(p);\n\n  elem.insertAdjacentElement(\"afterend\", row);\n}\n\nfunction findCell(msg) {\n  return $(`[src=\"${msg.item}\"]`, $(`.grid[data-user-id=\"${msg.id}\"]`)).parentElement;\n}\n\nfunction messageHandler(event, elem) {\n  const msg = JSON.parse(event.data);\n\n  switch (msg.type) {\n    case \"room_created\": {\n      $(\"#room_id\").innerHTML = `Created room with ID: <code>${msg.id}</code> (Give this to your teammates!)`;\n      break;\n    }\n\n    case \"room_joined\": {\n      const room_id = msg.id;\n      break;\n    }\n\n    case \"user_joined\": {\n      const newGrid = $(\".grid\").cloneNode(true);\n      newGrid.dataset.userId = msg.id;\n      $(\"main\").appendChild(newGrid);\n      break;\n    }\n\n    case \"user_left\": {\n      $(`.grid[data-user-id=\"${msg.id}\"]`).remove();\n      break;\n    }\n\n    case \"error\": {\n      createPRow(elem, `Error: ${msg.message}`);\n      break;\n    }\n\n    case \"user_primary\": {\n      handlePrimary({ currentTarget: findCell(msg) }, msg.offset);\n      break;\n    }\n\n    case \"user_secondary\": {\n      handleSecondary({ currentTarget: findCell(msg) });\n      break;\n    }\n\n    case \"user_disable\": {\n      handleDisable({ currentTarget: findCell(msg) });\n      break;\n    }\n  }\n}\n\n$(\"#co_op_join\").onsubmit = (event) => {\n  connectSocket(event.target);\n\n  socket.addEventListener(\"open\", () => {\n    socket.send(JSON.stringify({\n      type: \"join_room\",\n      room: $(\"#co_op_join input\").value,\n    }));\n  });\n  socket.addEventListener(\"message\", e => messageHandler(e, event.target));\n\n  return false;\n};\n\n$(\"#co_op_create\").onsubmit = (event) => {\n  connectSocket(event.target);\n\n  let size = parseInt($(\"#co_op_create input\").value);\n  if (!size) {\n    createPRow(event.target, \"Invalid or no size given, using default of 2.\");\n    size = 2;\n  }\n\n  const roomId = $(\"#room_id\");\n  roomId.classList.add(\"active\");\n  roomId.textContent = `Creating room...`;\n\n  socket.addEventListener(\"open\", () => {\n    socket.send(JSON.stringify({\n      type: \"create_room\",\n      size: size,\n    }));\n  });\n  socket.addEventListener(\"message\", e => messageHandler(e, event.target));\n\n  return false;\n};\n\nconst coOpColumnsElem = $(\"#co_op_columns\");\ntry { coOpColumnsElem.value = localStorage.coOpColumns ?? null }\ncatch {}\ncoOpColumnsElem.oninput = event => {\n  const columns = event.target.value;\n  const main = $(\"main\");\n\n  main.style.gridTemplateColumns = columns ? `repeat(${columns}, auto)`: null;\n\n  try { localStorage.coOpColumns = columns }\n  catch {}\n};\ncoOpColumnsElem.oninput({ target: coOpColumnsElem });\n"]}
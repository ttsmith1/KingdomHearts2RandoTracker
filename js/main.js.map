{"version":3,"sources":["../../js/main.js"],"names":[],"mappings":";;AAAC,SAAS,aAAT,CAAuB,IAAvB,EAA6B,IAA7B,EAAmC,MAAnC,EAA2C;AAC1C,MAAI,MAAM,IAAI,CAAC,IAAI,CAAC,aAAL,CAAmB,OAAnB,CAA2B,MAA1C,EAAkD;AAChD,IAAA,MAAM,CAAC,IAAP,CAAY,IAAI,CAAC,SAAL,CAAe;AACzB,MAAA,IAAI,EAAE,IADmB;AAEzB,MAAA,IAAI,EAAE,CAAC,CAAC,OAAD,EAAU,IAAV,CAAD,CAAiB,YAAjB,CAA8B,KAA9B,CAFmB;AAGzB,MAAA,MAAM,EAAE;AAHiB,KAAf,CAAZ;AAKD;AACF;;AAED,SAAS,aAAT,CAAuB,KAAvB,EAA0C;AAAA;;AAAA,MAAZ,MAAY,uEAAH,CAAG;AACxC,MAAM,IAAI,GAAG,KAAK,CAAC,aAAnB;AACA,MAAI,IAAI,CAAC,SAAL,CAAe,QAAf,CAAwB,UAAxB,CAAJ,EACE;AACA;AAEF,EAAA,aAAa,CAAC,cAAD,EAAiB,IAAjB,EAAuB,MAAvB,CAAb;AAEA,MAAM,MAAM,GAAG,CAAC,CAAC,SAAD,EAAY,IAAZ,CAAhB;AAEA,MAAM,KAAK,GAAG,MAAM,wBAAC,IAAI,CAAC,OAAL,CAAa,KAAd,qEAAuB,CAAvB,CAAN,GAAkC,OAAO,CAAC,MAAD,CAAvD;AACA,MAAM,GAAG,GAAG,KAAK,GAAG,CAApB,CAXwC,CAaxC;;AACA,MAAI,KAAK,GAAG,MAAM,wBAAC,IAAI,CAAC,OAAL,CAAa,KAAd,qEAAuB,CAAvB,CAAlB;AACA,MAAI,KAAK,KAAK,CAAV,IAAe,CAAC,CAAC,OAAD,EAAU,IAAV,CAAD,CAAiB,SAAjB,CAA2B,QAA3B,CAAoC,QAApC,CAAnB,EACE;AACA,IAAA,KAAK,GAAG,CAAC,KAAK,GAAG,CAAC,GAAG,GAAG,MAAP,IAAiB,GAA1B,IAAiC,GAAzC;AAEF,EAAA,IAAI,CAAC,OAAL,CAAa,KAAb,GAAqB,KAArB;AAEA,MAAI,MAAM,IAAI,KAAK,KAAK,KAAxB,EACE;AACA,IAAA,MAAM,CAAC,SAAP,CAAiB,GAAjB,CAAqB,QAArB;AAEF,MAAM,MAAM,GAAG,IAAI,CAAC,GAAL,CAAS,KAAT,EAAgB,KAAK,GAAG,OAAO,CAAC,MAAD,CAA/B,CAAf;AAEA,MAAM,KAAK,GAAG,IAAI,CAAC,OAAL,CAAa,KAA3B;AACA,MAAM,KAAK,GAAG,KAAK,GAAG,EAAE,yBAAiB,KAAjB,UAA4B,IAAI,CAAC,aAAjC,CAAL,GAAuD,CAAE,IAAF,CAA1E;AAEA,EAAA,KAAK,CAAC,OAAN,CAAc,UAAA,SAAS,EAAI;AACzB;AACA,IAAA,SAAS,CAAC,OAAV,CAAkB,KAAlB,GAA0B,KAA1B;AAEA,QAAM,IAAI,GAAG,IAAI,KAAK,SAAT,GAAqB,CAAC,CAAC,OAAD,EAAU,SAAV,CAAtB,GAA6C,IAA1D;AACA,QAAM,MAAM,GAAG,CAAC,CAAC,SAAD,EAAY,SAAZ,CAAhB;AACA,QAAM,MAAM,GAAG,CAAC,CAAC,SAAD,EAAY,SAAZ,CAAhB;AAEA,QAAI,MAAM,GAAG,CAAb,EACE,MAAM,SAAN,IAAA,MAAM,WAAN,YAAA,MAAM,CAAE,YAAR,CAAqB,KAArB,wBAA2C,MAA3C;;AAEF,YAAQ,KAAR;AACE,WAAK,CAAL;AACE;AACA,QAAA,IAAI,SAAJ,IAAA,IAAI,WAAJ,YAAA,IAAI,CAAE,SAAN,CAAgB,MAAhB,CAAuB,QAAvB;AACA,QAAA,MAAM,SAAN,IAAA,MAAM,WAAN,YAAA,MAAM,CAAE,SAAR,CAAkB,MAAlB,CAAyB,QAAzB;AACA,QAAA,MAAM,SAAN,IAAA,MAAM,WAAN,YAAA,MAAM,CAAE,SAAR,CAAkB,MAAlB,CAAyB,QAAzB;AACA;;AAEF,WAAK,CAAL;AACE;AACA,QAAA,IAAI,SAAJ,IAAA,IAAI,WAAJ,YAAA,IAAI,CAAE,SAAN,CAAgB,GAAhB,CAAoB,QAApB;AACA,QAAA,MAAM,SAAN,IAAA,MAAM,WAAN,YAAA,MAAM,CAAE,SAAR,CAAkB,MAAlB,CAAyB,QAAzB;AACA;;AAEF;AACE,QAAA,IAAI,SAAJ,IAAA,IAAI,WAAJ,YAAA,IAAI,CAAE,SAAN,CAAgB,GAAhB,CAAoB,QAApB;AACA,QAAA,MAAM,SAAN,IAAA,MAAM,WAAN,YAAA,MAAM,CAAE,SAAR,CAAkB,GAAlB,CAAsB,QAAtB;AACA;AAjBJ;AAmBD,GA9BD;AA+BD;;AAED,SAAS,eAAT,CAAyB,KAAzB,EAAgC;AAAA;;AAC9B,MAAM,IAAI,GAAG,KAAK,CAAC,aAAnB;AACA,MAAI,IAAI,CAAC,SAAL,CAAe,QAAf,CAAwB,UAAxB,CAAJ,EACE;AAEF,MAAM,SAAS,GAAG,CAAC,CAAC,YAAD,EAAe,IAAf,CAAnB;AACA,MAAI,CAAC,SAAL,EACE;AAEF,EAAA,aAAa,CAAC,gBAAD,EAAmB,IAAnB,CAAb;AAEA,MAAI,KAAK,GAAG,SAAS,CAAC,OAAV,CAAkB,KAA9B;AACA,MAAI,CAAC,KAAL,EACE;AACA,WAAO,SAAS,CAAC,SAAV,CAAoB,MAApB,CAA2B,QAA3B,CAAP,CAd4B,CAgB9B;;AACA,EAAA,KAAK,GAAG,IAAI,CAAC,KAAL,CAAW,SAAS,CAAC,OAAV,CAAkB,KAA7B,CAAR,CAjB8B,CAmB9B;;AACA,MAAI,KAAK,GAAG,MAAM,0BAAC,SAAS,CAAC,OAAV,CAAkB,KAAnB,yEAA4B,CAA5B,CAAN,GAAuC,CAAnD;AACA,MAAI,KAAK,IAAI,KAAK,CAAC,MAAN,GAAe,CAAnB,CAAL,KAA+B,CAAnC,EACE,KAAK,GAAG,CAAR,CADF,KAGE,SAAS,CAAC,YAAV,CAAuB,KAAvB,gBAAqC,KAAK,CAAC,KAAK,GAAG,CAAT,CAA1C,WAxB4B,CA0B9B;;AACA,MAAI,KAAK,GAAG,CAAZ,EACE,SAAS,CAAC,SAAV,CAAoB,MAApB,CAA2B,QAA3B;AAEF,EAAA,SAAS,CAAC,OAAV,CAAkB,KAAlB,GAA0B,KAA1B;AACD;;AAED,SAAS,aAAT,CAAuB,KAAvB,EAA8B;AAC5B,MAAM,IAAI,GAAG,KAAK,CAAC,aAAnB;AACA,EAAA,aAAa,CAAC,cAAD,EAAiB,IAAjB,CAAb;AACA,EAAA,IAAI,CAAC,SAAL,CAAe,MAAf,CAAsB,UAAtB;AACD,C,CAED;;;AACA,EAAE,CAAC,aAAD,CAAF,CAAkB,OAAlB,CAA0B,UAAA,IAAI,EAAI;AAChC,EAAA,IAAI,CAAC,WAAL,GAAmB,UAAA,KAAK,EAAI;AAC1B,YAAQ,KAAK,CAAC,MAAd;AACE,WAAK,CAAL;AACE;AACA,QAAA,aAAa,CAAC,KAAD,CAAb;AACA;;AAEF,WAAK,CAAL;AACE;AACA,QAAA,eAAe,CAAC,KAAD,CAAf;AACA;;AAEF,WAAK,CAAL;AACE;AACA,QAAA,aAAa,CAAC,KAAD,CAAb;AACA;AAdJ;AAgBD,GAjBD,CADgC,CAoBhC;;;AACA,EAAA,IAAI,CAAC,aAAL,GAAqB,UAAA,KAAK;AAAA,WAAI,KAAK,CAAC,cAAN,EAAJ;AAAA,GAA1B,CArBgC,CAuBhC;;;AACA,EAAA,IAAI,CAAC,OAAL,GAAe,UAAA,KAAK,EAAI;AACtB;AACA,QAAI,CAAC,UAAU,CAAC,OAAhB,EACE,OAHoB,CAKtB;;AACA,IAAA,KAAK,CAAC,cAAN,GANsB,CAQtB;;AACA,QAAM,MAAM,GAAG,KAAK,CAAC,MAAN,GAAe,CAAf,GAAmB,CAAnB,GAAuB,CAAC,CAAvC;AACA,IAAA,aAAa,CAAC,KAAD,EAAQ,MAAR,CAAb;AACD,GAXD;AAYD,CApCD;;AAsCA,QAAQ,CAAC,IAAT,CAAc,WAAd,GAA4B,UAAA,KAAK,EAAI;AACnC,MAAI,KAAK,CAAC,MAAN,KAAiB,CAArB,EACE;AACA,WAAO,KAAP;AACH,CAJD","file":"main.js","sourcesContent":["ï»¿function dispatchEvent(type, elem, offset) {\r\n  if (socket && !elem.parentElement.dataset.userId) {\r\n    socket.send(JSON.stringify({\r\n      type: type,\r\n      item: $(\".icon\", elem).getAttribute(\"src\"),\r\n      offset: offset,\r\n    }));\r\n  }\r\n}\r\n\r\nfunction handlePrimary(event, offset = 1) {\r\n  const elem = event.currentTarget;\r\n  if (elem.classList.contains(\"disabled\"))\r\n    // If the world/item is disabled, don't do anything\r\n    return;\r\n\r\n  dispatchEvent(\"user_primary\", elem, offset);\r\n\r\n  const nobody = $(\".nobody\", elem);\r\n\r\n  const total = Number(elem.dataset.total ?? 1) + Boolean(nobody);\r\n  const end = total + 1;\r\n\r\n  // Change level, resetting to 0 if >total, or wrapping to the end if <0\r\n  let level = Number(elem.dataset.level ?? 0)\r\n  if (level === 0 || $(\".icon\", elem).classList.contains(\"opaque\"))\r\n    // When in group, don't increase level if item unlocked for first time but already levelled\r\n    level = (level + (end + offset) % end) % end;\r\n\r\n  elem.dataset.level = level;\r\n\r\n  if (nobody && level === total)\r\n    // Show nobody symbol on last level\r\n    nobody.classList.add(\"opaque\");\r\n\r\n  const imgNum = Math.min(level, total - Boolean(nobody))\r\n\r\n  const group = elem.dataset.group;\r\n  const elems = group ? $$(`[data-group=\"${group}\"]`, elem.parentElement) : [ elem ];\r\n\r\n  elems.forEach(groupElem => {\r\n    // Change state for each item in group\r\n    groupElem.dataset.level = level;\r\n\r\n    const icon = elem === groupElem ? $(\".icon\", groupElem) : null;\r\n    const number = $(\".number\", groupElem);\r\n    const nobody = $(\".nobody\", groupElem);\r\n\r\n    if (imgNum > 1)\r\n      number?.setAttribute(\"src\", `img/numbers/${imgNum}.png`);\r\n\r\n    switch (level) {\r\n      case 0:\r\n        // Disable\r\n        icon?.classList.remove(\"opaque\");\r\n        number?.classList.remove(\"opaque\");\r\n        nobody?.classList.remove(\"opaque\");\r\n        break;\r\n\r\n      case 1:\r\n        // First state, don't show number yet\r\n        icon?.classList.add(\"opaque\");\r\n        number?.classList.remove(\"opaque\");\r\n        break;\r\n\r\n      default:\r\n        icon?.classList.add(\"opaque\");\r\n        number?.classList.add(\"opaque\");\r\n        break;\r\n    }\r\n  });\r\n}\r\n\r\nfunction handleSecondary(event) {\r\n  const elem = event.currentTarget;\r\n  if (elem.classList.contains(\"disabled\"))\r\n    return;\r\n\r\n  const secondary = $(\".secondary\", elem);\r\n  if (!secondary)\r\n    return;\r\n\r\n  dispatchEvent(\"user_secondary\", elem);\r\n\r\n  let files = secondary.dataset.files;\r\n  if (!files)\r\n    // A single image rather than an array\r\n    return secondary.classList.toggle(\"opaque\");\r\n\r\n  // Otherwise, parse JSON array\r\n  files = JSON.parse(secondary.dataset.files);\r\n\r\n  // Increment image index\r\n  let index = Number(secondary.dataset.index ?? 0) + 1;\r\n  if (index % (files.length + 1) === 0)\r\n    index = 0;\r\n  else\r\n    secondary.setAttribute(\"src\", `img/${files[index - 1]}.png`);\r\n\r\n  // We toggle the opaque class for 0 (disable) and 1 (enable)\r\n  if (index < 2)\r\n    secondary.classList.toggle(\"opaque\");\r\n\r\n  secondary.dataset.index = index;\r\n}\r\n\r\nfunction handleDisable(event) {\r\n  const elem = event.currentTarget;\r\n  dispatchEvent(\"user_disable\", elem);\r\n  elem.classList.toggle('disabled');\r\n}\r\n\r\n// Item clicking\r\n$$(\".grid > div\").forEach(elem => {\r\n  elem.onmousedown = event => {\r\n    switch (event.button) {\r\n      case 0:\r\n        // Left click\r\n        handlePrimary(event);\r\n        break;\r\n\r\n      case 2:\r\n        // Right click\r\n        handleSecondary(event);\r\n        break;\r\n\r\n      case 1:\r\n        // Middle click\r\n        handleDisable(event);\r\n        break;\r\n    }\r\n  };\r\n\r\n  // We have our own events for right click so the context menu would be intrusive\r\n  elem.oncontextmenu = event => event.preventDefault();\r\n\r\n  // Scroll to increment/decrement\r\n  elem.onwheel = event => {\r\n    // Check setting is on\r\n    if (!scrollElem.checked)\r\n      return;\r\n\r\n    // Prevent page scroll\r\n    event.preventDefault();\r\n\r\n    // Increment/decrement\r\n    const offset = event.deltaY < 0 ? 1 : -1;\r\n    handlePrimary(event, offset);\r\n  }\r\n});\r\n\r\ndocument.body.onmousedown = event => {\r\n  if (event.button === 1)\r\n    // Prevent autoscroll on middle click\r\n    return false;\r\n}\r\n"]}